---
title: "Untitled"
author: "Ania"
date: "15/02/2022"
output: html_document
---

#1. Loading packages:
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(readxl)
library(dplyr)
library(stringr)
library(tidyverse)
library(ggplot2)
library(hrbrthemes) # for heatmaps
library(magrittr)
library(pheatmap)
library(MixGHD) # hierarchical clustering which i will finally not use
library(viridis)
library(ggpubr)

```

#2.Functions
```{r}
DE_Genevestigator <- function(data, AMP_data, PRO_data, AMP = 2, PRO = 10){
  
  compounds_to_be_stored <- c()
  
  for (i in 1:nrow(data)) {
    if ((max(data[i,AMP_data]) >= AMP) & (max(data[i,PRO_data]) < PRO)) {
      
      compounds_to_be_stored[i] <- data[i,1]
      
    }
  }
  compounds_to_be_stored <- compounds_to_be_stored[!is.na(compounds_to_be_stored)]
  compounds_to_be_stored <- compounds_to_be_stored[!duplicated(compounds_to_be_stored)]
  
  return(data[data$Perturbations %in% compounds_to_be_stored,])
}

finding_selected_compounds <-function(results_data){
  selected_words <- c()
  for (i in 1:length(results_data$Perturbations)){
    selected_words[i] <- str_extract(results_data$Perturbations[i], "([^\\s]+)") } # extract the first word = compound
    return(unique(selected_words))
}

```

#3. Loading datasets
Using function DE_Genevestigator to select the compounds, which induce the desired expression level:
  -AMP > 2
  -PRO <10

U133A_2 platform:
```{r}
U133A_2 <- read_excel("/Users/Ania/Desktop/Szkoła/ENS /2nd_year/Stage/Practical/Genevestigator/Data/Toxicology-HS_AFFY_U133A-2.xlsx")

head(U133A_2)
```

U133PLUS_2_0 platform:
```{r}
U133PLUS_2_0 <- read_excel("/Users/Ania/Desktop/Szkoła/ENS /2nd_year/Stage/Practical/Genevestigator/Data/Toxicology-HS_AFFY_U133PLUS_2-0.xlsx")
head(U133PLUS_2_0)
```

U219_4 platform:
```{r}
U219_4 <-read_excel("/Users/Ania/Desktop/Szkoła/ENS /2nd_year/Stage/Practical/Genevestigator/Data/Toxicology-HS_AFFY_U219-4.xlsx")
head(U219_4)
```

LINC_L1000 platform:
```{r}
LINC_L1000 <-read_excel("/Users/Ania/Desktop/Szkoła/ENS /2nd_year/Stage/Practical/Genevestigator/Data/Toxicology-HS_LINC_L1000-3.xlsx")
head(LINC_L1000)
```
#4. Processing datasets
Here the goal is to make each platform useful for the downstream analysis.

U133A_2 platform:
```{r}
U133A_2 <-U133A_2[,-c(2:5)] # removing empty/not needed columns
colnames(U133A_2) <- c("Perturbations", "log2:BM2", "FC:BM2","p-value:BM2",
                       "log2:DEFB1", "FC:DEFB1","p-value:DEFB1",
                       "log2:DEFB4A", "FC:DEFB4A","p-value:DEFB4A",
                       "log2:CAMP", "FC:CAMP","p-value:CAMP",
                       "log2:REG3A", "FC:REG3A","p-value:REG3A",
                       "log2:PLA2G2A", "FC:PLA2G2A","p-value:PLA2G2A",
                       "log2:IL1B", "FC:IL1B","p-value:IL1B",
                       "log2:CXCL8", "FC:CXCL8","p-value:CXCL8",
                       "log2:TNF", "FC:TNF","p-value:TNF" ) # naming columns
U133A_2 <- U133A_2[5:nrow(U133A_2),] # removing empty/not needed rows

# turn all character columns into numeric 
class(U133A_2)
U133A_2_modified <-data.frame(lapply(U133A_2,as.numeric))
U133A_2_modified$Perturbations <- U133A_2$Perturbations
str(U133A_2_modified)


```
U133PLUS_2_0 platform:
```{r}
#modifying the table for analysis 
U133PLUS_2_0 <-U133PLUS_2_0[,-c(1,3,4,5)]
colnames(U133PLUS_2_0) <- c("Perturbations", "log2:BM2", "FC:BM2","p-value:BM2",
                       "log2:DEFB1", "FC:DEFB1","p-value:DEFB1",
                       "log2:DEFB4A", "FC:DEFB4A","p-value:DEFB4A",
                       "log2:DEFB103B", "FC:DEFB103B","p-value:DEFB103B",
                       "log2:DEFB104A", "FC:DEFB104A","p-value:DEFB104A",
                       "log2:CAMP", "FC:CAMP","p-value:CAMP",
                       "log2:REG3A", "FC:REG3A","p-value:REG3A",
                       "log2:PLA2G2A", "FC:PLA2G2A","p-value:PLA2G2A",
                       "log2:IL1B", "FC:IL1B","p-value:IL1B",
                       "log2:CXCL8", "FC:CXCL8","p-value:CXCL8",
                       "log2:TNF", "FC:TNF","p-value:TNF" )
#not all genes were found on this platform!
U133PLUS_2_0 <- U133PLUS_2_0[5:nrow(U133PLUS_2_0),]
class(U133PLUS_2_0)
str(U133PLUS_2_0)
U133PLUS_2_0_modified <-data.frame(lapply(U133PLUS_2_0,as.numeric))
U133PLUS_2_0_modified$Perturbations <- U133PLUS_2_0$Perturbations
str(U133A_2_modified)
U133PLUS_2_0_modified

```

U219-4 platform:
```{r}
#modifying the table for analysis 
U219_4 <-U219_4[,-c(1,3,4,5)]
colnames(U219_4) <- c("Perturbations", "log2:BM2", "FC:BM2","p-value:BM2",
                            "log2:DEFB1", "FC:DEFB1","p-value:DEFB1",
                            "log2:CAMP", "FC:CAMP","p-value:CAMP",
                            "log2:REG3A", "FC:REG3A","p-value:REG3A",
                            "log2:PLA2G2A", "FC:PLA2G2A","p-value:PLA2G2A",
                            "log2:IL1B", "FC:IL1B","p-value:IL1B",
                            "log2:CXCL8", "FC:CXCL8","p-value:CXCL8",
                            "log2:TNF", "FC:TNF","p-value:TNF" )
#not all genes were found on this platform!
U219_4 <- U219_4[5:nrow(U219_4),]
class(U219_4)
str(U219_4)
U219_4_modified <-data.frame(lapply(U219_4,as.numeric))
U219_4_modified$Perturbations <- U219_4$Perturbations
str(U219_4_modified)
U219_4_modified

```


```{r}
LINC_L1000 <-LINC_L1000[,-c(1,3,4,5)]
colnames(LINC_L1000) <- c("Perturbations", 
                          "log2:BM2", "FC:BM2","p-value:BM2",
                      "log2:DEFB1", "FC:DEFB1","p-value:DEFB1",
                      "log2:DEFB4A", "FC:DEFB4A","p-value:DEFB4A",
                      "log2:CAMP", "FC:CAMP","p-value:CAMP",
                      "log2:REG3A", "FC:REG3A","p-value:REG3A",
                      "log2:PLA2G2A", "FC:PLA2G2A","p-value:PLA2G2A",
                      "log2:IL1B", "FC:IL1B","p-value:IL1B",
                      "log2:CXCL8", "FC:CXCL8","p-value:CXCL8",
                      "log2:TNF", "FC:TNF","p-value:TNF" )
#not all genes were found on this platform!
LINC_L1000 <- LINC_L1000[5:nrow(LINC_L1000),]
class(LINC_L1000)
str(LINC_L1000)
LINC_L1000_modified <-data.frame(lapply(LINC_L1000,as.numeric))
LINC_L1000_modified$Perturbations <- LINC_L1000$Perturbations
str(LINC_L1000_modified)
LINC_L1000_modified

```

#5. Filtering datasets
-AMP >= 2, PRO <=10
-Each platform has a different completion of the missing genes

U133A platform:
```{r, echo=FALSE}
#genes
AMP_U133A_2 <- c("FC.BM2","FC.DEFB1","FC.DEFB4A", "FC.CAMP","FC.REG3A","FC.PLA2G2A")
PRO_U133A_2 <- c("FC.IL1B","FC.CXCL8","FC.TNF")

results_U133A <- DE_Genevestigator(U133A_2_modified,AMP_data = AMP_U133A_2,PRO_data = PRO_U133A_2)
head(results_U133A)
```

U133PLUS_2_0 platform:
```{r, echo=FALSE}
##genes
AMP_U133PLUS_2_0 <- c("FC.BM2","FC.DEFB1","FC.DEFB4A","FC.DEFB103B","FC.DEFB104A", "FC.CAMP","FC.REG3A","FC.PLA2G2A")
PRO_U133PLUS_2_0 <- c("FC.IL1B","FC.CXCL8","FC.TNF")

results_U133PLUS <- DE_Genevestigator(U133PLUS_2_0_modified,AMP_data = AMP_U133PLUS_2_0,PRO_data = PRO_U133PLUS_2_0)
head(results_U133PLUS)

```

U219_4 platform:
```{r}
#genes
AMP_U219_4 <- c("FC.BM2","FC.DEFB1","FC.CAMP","FC.REG3A","FC.PLA2G2A")
PRO_U219_4 <- c("FC.IL1B","FC.CXCL8","FC.TNF")

DE_Genevestigator(U219_4_modified,AMP_data = AMP_U219_4,PRO_data = PRO_U219_4) # nothing

DE_Genevestigator(U219_4_modified,AMP_data = AMP_U219_4,PRO_data = PRO_U219_4,AMP = 0, PRO = 0) # but works

```
```{r}
#genes
AMP_LINC_L1000 <- c("FC.BM2","FC.DEFB1","FC.DEFB4A","FC.CAMP","FC.REG3A","FC.PLA2G2A")
PRO_LINC_L1000 <- c("FC.IL1B","FC.CXCL8","FC.TNF")

results_LINC <-DE_Genevestigator(LINC_L1000_modified,AMP_data = AMP_LINC_L1000,PRO_data = PRO_LINC_L1000)

```

#6. Selecting compounds that match conditions only.

U133A:
```{r}
finding_selected_compounds(results_U133A)
length(finding_selected_compounds(results_U133A))
```

U133PLUS_2-0
```{r}
finding_selected_compounds(results_U133PLUS)
length(finding_selected_compounds(results_U133PLUS))
```

U219-4:
```{r}
0
```

LINC-100:
```{r}
finding_selected_compounds(results_LINC)
length(finding_selected_compounds(results_LINC))
```

#7. Heat maps (of filtered genes only)

U133A & U133PLUS_2-0 together:

-Manipulations:
```{r}
Pert_names_before_U133PLUS <-results_U133PLUS$Perturbations #keep pertubrations column, keep names only!

Pert_names_after_U133PLUS <-c()
for (i in 1:length(Pert_names_before_U133PLUS)) {
  Pert_names_after_U133PLUS[i] <- str_extract(Pert_names_before_U133PLUS[i], "([^\\s]+)") 
}

U133PLUS_tobeJoined <-results_U133PLUS[ , grepl( "FC." , names(results_U133PLUS) ) ]

U133PLUS_tobeJoined$Perturbations <- Pert_names_after_U133PLUS

#remove repetitions
U133PLUS_tobeJoined_final <- U133PLUS_tobeJoined[-c(2,3,5,6,7,9,10,15,16,17,22,24,30,31,35),]

colnames(U133PLUS_tobeJoined_final) <- c("BM2", "DEFB1","DEFB4A","DEFB103B","DEFB104A", "CAMP", "REG3A", "PLA2G2A", "IL1B", "IL8", "TNF", "Perturbations")

# done separately for results_U133A

results_U133A$Index <- c(1:nrow(results_U133A))
#remove duplicated studies, when more cells keep cell MCF7, so remove row: 14,17,28,26
results_U133A_for_analysis <- results_U133A[-c(14,17,26,28),]
#remove columns you won't use for the analysis
results_U133A_for_analysis <- results_U133A_for_analysis
Perturbations_to_keep <-results_U133A_for_analysis$Perturbations #keep pertubrations column, keep names only!
for (i in 1:length(Perturbations_to_keep)) {
  Perturbations_to_keep[i] <- str_extract(Perturbations_to_keep[i], "([^\\s]+)") 
}
# perturbation column is lost here!
results_U133A_for_analysis <-results_U133A_for_analysis[ , grepl( "FC." , names(results_U133A_for_analysis ) ) ]

#change names of columns
colnames(results_U133A_for_analysis) <- c("BM2", "DEFB1","DEFB4A", "CAMP", "REG3A", "PLA2G2A", "IL1B", "IL8", "TNF")

results_U133A_for_analysis$Perturbations <-Perturbations_to_keep

#combine the two tables! # they have different dimensions, results_U133A_for_analysis is missing two columns 

U133PLUS_tobeJoined_final
results_U133A_for_analysis
joined_tables <-full_join(U133PLUS_tobeJoined_final, results_U133A_for_analysis) 
head(joined_tables)
```

-Hierarchical clustering:
```{r}
#the format of the table is correct, just remove the perturbations

hierarchical_analysis <-joined_tables[,2:(ncol(joined_tables)-1)]
rownames(hierarchical_analysis) <- make.names(joined_tables[,12], unique = TRUE)

unsc_ward <- pheatmap(hierarchical_analysis, clustering_method = "ward.D2", show_colnames = TRUE, show_rownames = TRUE, annotation_legend = FALSE, cluster_cols = FALSE,scale = "row",)
print(unsc_ward)
```

-Or if you're not sure: simple heatmap instead:
```{r}
joined_tables

joined_tables_for_visualisation <-gather(data =joined_tables,key = "Gene", value = "Expression_Ratio", -Perturbations)

joined_tables_for_visualisation$Gene <- factor(joined_tables_for_visualisation$Gene, levels = c("BM2", "DEFB1","DEFB4A","DEFB103B", "DEFB104A", "CAMP", "REG3A", "PLA2G2A", "IL1B", "IL8", "TNF"))

ggplot(joined_tables_for_visualisation, aes(x = Gene, y = Perturbations, fill = Expression_Ratio)) +
  geom_tile() +
  theme_classic() +
  scale_fill_viridis()

```


LINC-1000:
```{r}
LINC_perturbations <-results_LINC$Perturbations
length(LINC_perturbations) #nrow - 6809

LINC_time <- c()
LINC_conc <- c()
LINC_cell <- c()
LINC_compound <- c()

for (i in 1:length(LINC_perturbations)){
  
  linc_perturbations_results <- str_match(as.list(LINC_perturbations[i]), ".+\\((.+)\\;\\s?(.+)\\;\\s?(.+)\\).*\\(.*")
  LINC_time[i] <- linc_perturbations_results[2]
  LINC_conc[i] <- linc_perturbations_results[3]
  LINC_cell[i] <- linc_perturbations_results[4]
  
  LINC_compound[i] <-str_extract(results_LINC$Perturbations[i], "([^\\s]+)") 
  

}

#before you add  new columns, extract only FC columns
results_LINC_1 <-results_LINC[, grepl("FC.", names(results_LINC))]
colnames(results_LINC_1) <- c("BM2","DEFB1", "DEFB4A", "CAMP", "REG3A", "PLA2G2A", "IL1B", "IL8", "TNF")

#now add time, conc, cell type and compound to the result list:
results_LINC_1$Time <-LINC_time
results_LINC_1$Concentration <-LINC_conc
results_LINC_1$Cell <-LINC_cell
results_LINC_1$Perturbations <-LINC_compound

unique(LINC_conc) #"0.04uM" "0.12uM" "0.37uM" "1.11uM" "3.33uM" "10uM"  
unique(LINC_time) # "24h" "3h" 
unique(LINC_cell) #"A375"     "HA1E"     "HT29"     "A549"     "HEPG2"    "MCF7" [7] "HCC515"   "PC3"      "BT20"     "HS578T"   "SKBR3"    "HME1"    "LNCAP"    "MCF10A"   "MDAMB231"

LINC_unique_only<-results_LINC_1[!duplicated(results_LINC_1$Perturbations),]


# hierarchical clustering 
LINC_hierarchy <-LINC_unique_only[,2:9]
rownames(LINC_hierarchy) <- make.names(LINC_unique_only[,13], unique = TRUE)

unsc_ward_LINC <- pheatmap(LINC_hierarchy, clustering_method = "ward.D2", show_colnames = TRUE, show_rownames = FALSE, annotation_legend = FALSE, scale = "row", cluster_cols = FALSE)

```

#8. Ratios

All platforms, filtered compounds only. Unique compounds!

```{r}
U133PLUS_tobeJoined_final
results_U133A_for_analysis
LINC_unique_only

all_platforms_joined <-full_join(joined_tables,LINC_unique_only[,-c(10:12)])

AMP_genes <- c("DEFB1",	"DEFB4A",	"DEFB103B",	"DEFB104A",	"CAMP",	"REG3A",	"PLA2G2A")
PRO_genes <- c("IL1B","IL8","TNF")
all_platforms_joined 
  
ratio_values <- c() 
for (i in 1:nrow(all_platforms_joined)){
  ratio_values[i] <- (sum(all_platforms_joined[i,AMP_genes],na.rm = TRUE)/length(AMP_genes))/(sum(all_platforms_joined[i,PRO_genes],na.rm = TRUE)/length(PRO_genes))
}

all_platforms_joined$Ratios <-ratio_values

ggplot(all_platforms_joined, aes(x = Perturbations, y = Ratios, colour = dplyr::case_when(Ratios > 1 ~ ">1", Ratios < 1 ~ "<1"))) +
  geom_point() + 
  scale_y_continuous(trans = "log10") +
  theme_classic() +
   theme(axis.text.x=element_blank(),
         axis.ticks.x=element_blank())+
  scale_colour_discrete("Ratio") +
  xlab("Compound")+
  ylab("Ratio (AMP/PRO)")
## now I can say, filter the table to only get values with ratio > 1

```

Ratios quantitatively
```{r} 
# Filter compounds that have ratio above 1, and see how many they are
compounds_with_higher_ratios <-all_platforms_joined %>%
  filter(Ratios > 1) ## 52 compounds!
```

```{r}
 #hierarchical clustering of the 52 compounds (not the ordered compounds)
higher_ratios_hierarchical  <- compounds_with_higher_ratios[,2:(ncol(compounds_with_higher_ratios)-2)]

pheatmap(higher_ratios_hierarchical, clustering_method = "ward.D2", show_colnames = TRUE, show_rownames = FALSE, annotation_legend = FALSE, cluster_cols = FALSE,scale = "row",main = "Compounds with ratio above 1")
  ## so from all of the compounds, these are the ones that have ratio above 1. 
```

```{r}
#alternatively what I can do is to get the highest ratios simply and choose the 10-20 first values
sorted_ratios_all_compounds <-all_platforms_joined %>%
  arrange(desc(Ratios))
dim(sorted_ratios_all_compounds) #317 compounds (compounds from the 3 platforms, without filtering for DE >1 )

head(sorted_ratios_all_compounds,30)

```

```{r}
 #hierarchical clustering of the 52 compounds (not the ordered compounds)
ratios_hierarchical_sorted  <- sorted_ratios_all_compounds[,2:(ncol(sorted_ratios_all_compounds)-2)]

pheatmap(ratios_hierarchical_sorted, clustering_method = "ward.D2", show_colnames = TRUE, show_rownames = FALSE, annotation_legend = FALSE, cluster_cols = FALSE,scale = "row",main = "Filtered compounds from all platforms ")
  ## so from all of the compounds, these are the ones that have ratio above 1. 
```

#9. Showing genes for data separately (playing around)

Starting with LINC-1000 as it has such a huge number of compounds. What I do here, I should do it at the beginning for each platform.


```{r}
dim(LINC_L1000)


LINC_full_table_time <- c()
LINC_full_table_conc <- c()
LINC_full_table_cell <- c()
LINC_full_table_compound <- c()

for (i in 1:length(LINC_L1000$Perturbations)){
  
  linc_perturbations_results <- str_match(as.list(LINC_L1000$Perturbations[i]), ".+\\((.+)\\;\\s?(.+)\\;\\s?(.+)\\).*\\(.*")
  LINC_full_table_time[i] <- linc_perturbations_results[2]
  LINC_full_table_conc[i] <- linc_perturbations_results[3]
  LINC_full_table_cell[i] <- linc_perturbations_results[4]
  
  LINC_full_table_compound[i] <-str_extract(LINC_L1000$Perturbations[i], "([^\\s]+)") 
  
  
}

LINC_L1000_FC <- LINC_L1000[, grepl("FC.",names(LINC_L1000))]
LINC_L1000_FC <-data.frame(lapply(LINC_L1000_FC,as.numeric))
str(LINC_L1000_FC)

LINC_L1000_FC$Compound <- LINC_full_table_compound
LINC_L1000_FC$Time <-LINC_full_table_time
LINC_L1000_FC$Concentration <- LINC_full_table_conc
LINC_L1000_FC$Cell <-LINC_full_table_cell

```

Working with Ibrutinib data only
```{r}
ibrutinib <- LINC_L1000_FC %>%
  filter(Compound == "ibrutinib")

unique(ibrutinib$Concentration) #"0.04uM" "0.12uM" "0.37uM" "1.11uM" "3.33uM" "10uM" 
unique(ibrutinib$Cell)
head(ibrutinib)
```

Preparing Ibrutinib data for visualisation
```{r}
ibrutinib_gathered <- gather(data = ibrutinib,key = "Gene", value = "Expression_Ratio", -c(Compound, Time, Concentration,Cell))

ibrutinib_gathered$Gene <- factor(ibrutinib_gathered$Gene, levels = c("FC.BM2", "FC.DEFB1","FC.DEFB4A","FC.CAMP", "FC.REG3A", "FC.PLA2G2A", "FC.IL1B", "FC.CXCL8", "FC.TNF"))

ibrutinib_gathered$Concentration <- factor(ibrutinib_gathered$Concentration, levels = c("0.04uM", "0.12uM", "0.37uM", "1.11uM", "3.33uM", "10uM"))

```

There are plenty of conditions in LINC data: Time, concentration, cell type, compound. Ibrutinib time-only 24h, let's see how values change across cell types.

One cell type, but concentrations shown
```{r}
A375 <-ggplot(ibrutinib_gathered[ibrutinib_gathered$Cell == "A375",],mapping = aes(x = Gene, y = Expression_Ratio, fill =Concentration)) +
  geom_bar(stat = "identity",position = "dodge") +
  theme_classic() +
A375

```

```{r}
ibrutinib_gathered %>%
  filter(Gene == "FC.DEFB4A", Cell == "A375") %>%
  ggplot(aes(x = Concentration, y = Expression_Ratio)) +
  geom_point() +
  geom_line(group = 1) +
 theme_classic() +
  ylab("HBD2 Expression Ratio") +
  xlab("Concentration")

```
```{r}
ibrutinib_gathered %>%
  filter(Gene == "FC.TNF", Cell == "A375") %>%
  ggplot(aes(x = Concentration, y = Expression_Ratio)) +
  geom_point() +
  geom_line(group = 1) +
 theme_classic() +
  ylab("TNF Expression Ratio") +
  xlab("Concentration")


```
All of cell types at once, not a good plot
```{r}
ggplot(ibrutinib_gathered[ibrutinib_gathered$Gene == "FC.DEFB4A",],mapping = aes(x = Cell, y = Expression_Ratio, colour =Concentration)) +
 geom_point() +
  geom_line(aes(group = Concentration)) +
theme_classic() +
  ylab("HBD2:Expression Ratio")
```

Same idea but better plot I think: shows differences between cell types
```{r}
ggplot(ibrutinib_gathered[ibrutinib_gathered$Gene == "FC.DEFB4A",],mapping = aes(x = Cell, y = Expression_Ratio)) +
    geom_boxplot(outlier.colour = "white") +
  geom_point(aes(colour = Concentration)) +
  theme_classic() +
  ylab("HBD2 Expression Ratio") +
  xlab("Cell type") +
  coord_flip()

```


Okay now let's try to do some time plots. For that I need a different drug where different times were used. Next drug with the greatest ratio and with different times: JNK-9L

-creating separate data
```{r}
JNK_9L <- LINC_L1000_FC %>%
  filter(Compound == "JNK-9L")

unique(JNK_9L$Concentration) #"0.04uM" "0.12uM" "0.37uM" "1.11uM" "3.33uM" "10uM" 
unique(JNK_9L$Cell) #[1] "BT20"     "HME1"     "HS578T"   "LNCAP"    "MCF7"     "MCF10A"  "MDAMB231" "SKBR3"    "A375"     "A549"     "HA1E"     "HCC515"  
"HEPG2"    "HT29"     "PC3"
unique(JNK_9L$Time) #"3h"  "24h"
head(JNK_9L)

```

-Preparing JNK-9L data for visualisation
```{r}
JNK_9L_gathered <- gather(data = JNK_9L,key = "Gene", value = "Expression_Ratio", -c(Compound, Time, Concentration,Cell))

JNK_9L_gathered$Gene <- factor(JNK_9L_gathered$Gene, levels = c("FC.BM2", "FC.DEFB1","FC.DEFB4A","FC.CAMP", "FC.REG3A", "FC.PLA2G2A", "FC.IL1B", "FC.CXCL8", "FC.TNF"))

JNK_9L_gathered$Concentration <- factor(JNK_9L_gathered$Concentration, levels = c("0.04uM", "0.12uM", "0.37uM", "1.11uM", "3.33uM", "10uM"))

JNK_9L_gathered$Time <- factor(JNK_9L_gathered$Time, levels = c( "3h", "24h"))

head(JNK_9L_gathered)
```

-Expression of HBD2 across different time points (2 only!)
```{r}

JNK_9L_gathered %>%
  filter(Cell == "BT20", Gene == "FC.DEFB4A") %>%
ggplot(aes(x = Time, y = Expression_Ratio)) +
  geom_boxplot() +
  geom_jitter(aes(colour = Concentration)) +
  theme_classic() +
  ylab("HBD2 Expression Ratio") 
  

```

-Expression of TNF across different time points (2 only!)
```{r}

JNK_9L_gathered %>%
  filter(Cell == "BT20", Gene == "FC.TNF") %>%
ggplot(aes(x = Time, y = Expression_Ratio)) +
  geom_boxplot(outlier.colour = "white") +
  geom_jitter(aes(colour = Concentration)) +
  theme_classic() +
  ylab("TNF Expression Ratio") 
  

```
